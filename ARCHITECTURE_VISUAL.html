<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Multi-Cloud Infrastructure Planner Architecture</title>
    <style>
      :root {
        --bg: #f3f8f9;
        --panel: #ffffff;
        --ink: #10242f;
        --muted: #4e6878;
        --stroke: #d8e3e8;
      }
      body {
        margin: 0;
        font-family: "Segoe UI", Arial, sans-serif;
        color: var(--ink);
        background: linear-gradient(135deg, #eff7ff, #eefcf2);
      }
      .wrap {
        width: min(1200px, calc(100vw - 2rem));
        margin: 1.2rem auto 2rem;
      }
      .hero {
        background: var(--panel);
        border: 1px solid var(--stroke);
        border-radius: 18px;
        padding: 1rem 1.2rem;
        margin-bottom: 1rem;
      }
      h1 {
        margin: 0;
        font-size: 2rem;
      }
      p {
        margin: 0.5rem 0 0;
        color: var(--muted);
      }
      .grid {
        display: grid;
        gap: 1rem;
      }
      .card {
        background: var(--panel);
        border: 1px solid var(--stroke);
        border-radius: 18px;
        padding: 0.8rem;
      }
      .card h2 {
        margin: 0.2rem 0 0.8rem;
        padding: 0 0.4rem;
        font-size: 1.1rem;
      }
      .mermaid {
        background: #fbfdff;
        border: 1px solid var(--stroke);
        border-radius: 14px;
        padding: 0.4rem;
        overflow: auto;
      }
      ul {
        margin: 0.6rem 0 0.2rem;
        color: var(--muted);
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <section class="hero">
        <h1>AI Multi-Cloud Infrastructure Planner Architecture</h1>
        <p>
          Full-stack fan-out/fan-in orchestration. One validated infrastructure input fans out to
          AWS/GCP/Azure agent calls in parallel, then fans in to a final recommendation agent.
        </p>
      </section>

      <div class="grid">
        <section class="card">
          <h2>System Topology</h2>
          <div class="mermaid">
flowchart LR
    U[User]
    FE[React Frontend<br/>Hooks + Axios<br/>Port 5173]
    API[Backend API<br/>Node + Express<br/>POST /pipeline/run<br/>Port 4000]
    VAL[Input Validation<br/>region/compute/storage/database/traffic]
    ORCH[Orchestrator Service<br/>Promise.all fan-out]
    AWS[AWS Agent Call<br/>xAI Grok]
    GCP[GCP Agent Call<br/>xAI Grok]
    AZ[Azure Agent Call<br/>xAI Grok]
    FIN[Final Recommendation Agent<br/>xAI Grok fan-in]

    U -->|submit requirements| FE
    FE -->|JSON payload| API
    API --> VAL
    VAL --> ORCH
    ORCH --> AWS
    ORCH --> GCP
    ORCH --> AZ
    AWS --> ORCH
    GCP --> ORCH
    AZ --> ORCH
    ORCH --> FIN
    FIN --> API
    API -->|cloud plans + final recommendation| FE
    FE -->|stage + results UI| U
          </div>
        </section>

        <section class="card">
          <h2>Pipeline Sequence</h2>
          <div class="mermaid">
sequenceDiagram
    autonumber
    participant B as Browser (React)
    participant A as Backend API (Express)
    participant O as Orchestrator
    participant X as xAI Grok API

    B->>A: POST /pipeline/run(requirements)
    A->>A: Validate + normalize input
    A->>O: runPipeline(requirements)

    par Fan-out in parallel
      O->>X: AWS planning prompt
      X-->>O: AWS plan JSON
    and
      O->>X: GCP planning prompt
      X-->>O: GCP plan JSON
    and
      O->>X: Azure planning prompt
      X-->>O: Azure plan JSON
    end

    O->>X: Final merge prompt with all 3 plans
    X-->>O: Final recommendation JSON
    O-->>A: cloudPlans + finalRecommendation
    A-->>B: completed response + stage metadata
    B->>B: render stage, fan-out cards, and cost table
          </div>
        </section>

        <section class="card">
          <h2>Design Choices</h2>
          <ul>
            <li>Fan-out uses Promise.all for minimum 3 concurrent provider calls.</li>
            <li>Fan-in is a separate final AI call for cross-provider comparison.</li>
            <li>Backend normalizes model JSON to keep frontend rendering stable.</li>
            <li>UI highlights current stage and exposes both intermediate and final outputs.</li>
          </ul>
        </section>
      </div>
    </div>

    <script type="module">
      import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs";
      mermaid.initialize({
        startOnLoad: true,
        theme: "base",
        themeVariables: {
          fontFamily: "Segoe UI, Arial, sans-serif",
          fontSize: "15px",
          primaryColor: "#e9f7ff",
          primaryBorderColor: "#3d6f95",
          lineColor: "#3e6178",
          tertiaryColor: "#eef9f1",
          signalColor: "#2d638e"
        },
        sequence: {
          useMaxWidth: true,
          wrap: true
        },
        flowchart: {
          curve: "basis"
        }
      });
    </script>
  </body>
</html>
